# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

pool:
    vmImage: windows-2019

variables:
  version: '1.1.0'
  buildConfiguration: 'Release'
  solutionDirectory: '$(System.DefaultWorkingDirectory)/CSharpSeleniumWebdriverSample'
  outputDirectory: '$(solutionDirectory)/CSharpSeleniumWebdriverSample/bin/$(buildConfiguration)'

steps:
- task: DotNetCoreInstaller@1
  inputs:
    version: '2.2.401'

- task: NodeTool@0
  inputs:
    versionSpec: '10.16.2'
  displayName: use node 10.16.2

- script: dotnet restore
  displayName: dotnet restore
  workingDirectory: $(solutionDirectory)

- script: dotnet build --no-restore -c $(buildConfiguration) -p:Version=$(version)
  displayName: dotnet build
  workingDirectory: $(solutionDirectory)

- script: dotnet test --no-restore --logger:trx
  displayName: dotnet test
  workingDirectory: $(solutionDirectory)

- task: PublishTestResults@2
  displayName: publish test results
  inputs:
      testResultsFiles: '**/TestResults/*.trx'
      testResultsFormat: VSTest
      searchFolder: $(solutionDirectory)
      testRunTitle: dotnet test
  condition: succeededOrFailed()

- publish: $(outputDirectory)
  displayName: publish drop
  name: drop